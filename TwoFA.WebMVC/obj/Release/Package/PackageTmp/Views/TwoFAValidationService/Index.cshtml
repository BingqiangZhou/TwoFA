@model VerifyModel
@{
    ViewBag.Title = "验证";
    Layout = "~/Views/Shared/_LayoutHomeOperator.cshtml";
    var siteURL = System.Configuration.ConfigurationManager.AppSettings["SiteURL"];
}

@section Script{
<script type="text/javascript">
    $(document).ready(function () {
        $("button").click(function () {
            //alert("hello")
            var code = $(".form-control").val();
            if (code.length != 6) {
                return;
            }
            $("#errorMsg").text("正在验证中...");
            console.log(code);
            $.ajax({
                url: '@siteURL'+"/api/TwoFA/VerifyAccount",
                data: {
                    'code': code,
                    'userName': '@Model.userName',
                    'mId': '@Model.mId',
                    'token': '@Model.token',
                },
                method: "post",
                success: function (res) {
                    if (res.Result == false) {
                        $("#errorMsg").text(res.ErrorMsg);
                    }
                    else {
                        //转到页面
                        //$("#errorMsg").text("验证成功");
                        //$(":root").load($("#verifySuccess").attr("href"));
                        location.replace("http://"+location.host + $("#verifySuccess").attr("href"))
                        //$("#verifySuccess").click();
                    }
                },
                error: function () {
                    $("#errorMsg").text("出错了，请联系相关技术人员！");
                }
            });
        })
    })
</script>
}
@Html.ActionLink("_", "VerifySuccess", "TwoFAValidationService", Model, new { id = "verifySuccess", style = "display:none;" })
@*@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()//避免CSRF攻击*@
    <div class="text-center mb-4">
        <h1 class="h3 mb-3 font-weight-normal">两步验证</h1>
        <p>请输入验证码</p>
    </div>
    <div class="col-lg-4 offset-lg-4">
        @Html.HiddenFor(m => m.mId)
        @Html.HiddenFor(m => m.userName)
        @Html.HiddenFor(m => m.token)
        <div class="login-info">
            <div class="form-label-group">
                @Html.DisplayNameFor(m => m.code)<text id="errorMsg" style="float:right;color:red;"></text>
                @Html.TextBoxFor(m => m.code, new { @class = "form-control" })
                @Html.ValidationMessageFor(m => m.code)
            </div>
        </div>
        <button class="btn btn-lg  btn-primary btn-block" style="margin-top:20px;" type="button">验证</button>
        <div class="text-center">
            @Html.ActionLink("无法验证", "Index", "TwoFAReset", Model, null)
        </div>
    </div>
@*}*@
